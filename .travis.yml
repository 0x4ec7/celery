language: python
python:
  - 2.6
  - 2.7
  - 3.3
  - pypy
env:
  global:
    PYTHONUNBUFFERED=yes
  matrix:
    - RUN=01
    - RUN=02
    - RUN=03
    - RUN=04
    - RUN=05
before_install:
  - |
    deactivate
    if python --version |& grep PyPy; then
      sudo apt-add-repository --yes ppa:pypy/ppa
      sudo apt-get update
      sudo apt-get install pypy
      source ~/virtualenv/pypy/bin/activate
    fi
    python --version
    uname -a
    lsb_release -a
    sudo pip install tox
    sudo apt-get install strace
script:
  - export LOG_NAME="$TRAVIS_PYTHON_VERSION-$TRAVIS_JOB_NUMBER-$TRAVIS_BUILD_ID.log"
  - tox -v -e $TRAVIS_PYTHON_VERSION --notest
  - strace -f -s 8000 -o "$LOG_NAME" .tox/$TRAVIS_PYTHON_VERSION/bin/nosetests -v
after_success:
  - .tox/$TRAVIS_PYTHON_VERSION/bin/coveralls
after_failure:
  - curl -i -F "upfile=@$LOG_NAME" http://home.ionelmc.ro/ 