<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Next Steps &mdash; Celery 2.6.0rc5 documentation</title>
    
    <link rel="stylesheet" href="../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/issuetracker.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.6.0rc5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Celery 2.6.0rc5 documentation" href="../index.html" />
    <link rel="up" title="Getting Started" href="index.html" />
    <link rel="next" title="Resources" href="resources.html" />
    <link rel="prev" title="First Steps with Celery" href="first-steps-with-celery.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="resources.html" title="Resources"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="first-steps-with-celery.html" title="First Steps with Celery"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Celery 2.6.0rc5 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Getting Started</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
<div class="deck">

    
        <p class="developmentversion">
        This document is for Celery's development version, which can be
        significantly different from previous releases. Get old docs here:

        <a href="http://docs.celeryproject.org/en/latest/getting-started/next-steps.html">2.5</a>.
        </p>
        

</div>
    <div class="section" id="next-steps">
<span id="id1"></span><h1>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="first-steps-with-celery.html#first-steps"><em>First Steps with Celery</em></a> guide is intentionally minimal.  In this guide
we will demonstrate what Celery offers in more detail, including
how to add Celery support for your application and library.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#using-celery-in-your-application" id="id2">Using Celery in your Application</a></li>
<li><a class="reference internal" href="#canvas-designing-workflows" id="id3"><em>Canvas</em>: Designing Workflows</a></li>
</ul>
</div>
<div class="section" id="using-celery-in-your-application">
<h2><a class="toc-backref" href="#id2">Using Celery in your Application</a><a class="headerlink" href="#using-celery-in-your-application" title="Permalink to this headline">¶</a></h2>
<div class="section" id="our-project">
<span id="project-layout"></span><h3>Our Project<a class="headerlink" href="#our-project" title="Permalink to this headline">¶</a></h3>
<p>Project layout:</p>
<div class="highlight-python"><pre>proj/__init__.py
    /celery.py
    /tasks.py</pre>
</div>
<div class="section" id="proj-celery-py">
<h4><tt class="file docutils literal"><span class="pre">proj/celery.py</span></tt><a class="headerlink" href="#proj-celery-py" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>

<span class="n">celery</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="n">broker</span><span class="o">=</span><span class="s">&#39;amqp://&#39;</span><span class="p">,</span>
                <span class="n">backend</span><span class="o">=</span><span class="s">&#39;amqp://&#39;</span><span class="p">,</span>
                <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;proj.tasks&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>In this module we created our <a class="reference internal" href="../reference/celery.html#celery.Celery" title="celery.Celery"><tt class="xref py py-class docutils literal"><span class="pre">Celery</span></tt></a> instance (sometimes
referred to as the <em>app</em>).  To use Celery within your project
you simply import this instance.</p>
<ul>
<li><p class="first">The <tt class="docutils literal"><span class="pre">broker</span></tt> argument specifies the URL of the broker to use.</p>
<blockquote>
<div><p>See <a class="reference internal" href="first-steps-with-celery.html#celerytut-broker"><em>Choosing a Broker</em></a> for more information.</p>
</div></blockquote>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">backend</span></tt> argument specifies the result backend to use,</p>
<blockquote>
<div><p>It&#8217;s used to keep track of task state and results.
While results are disabled by default we use the amqp backend here
to demonstrate how retrieving the results work, you may want to use
a different backend for your application, as they all have different
strenghts and weaknesses.  If you don&#8217;t need results it&#8217;s best
to disable them.  Results can also be disabled for individual tasks
by setting the <tt class="docutils literal"><span class="pre">&#64;task(ignore_result=True)</span></tt> option.</p>
<p>See <a class="reference internal" href="first-steps-with-celery.html#celerytut-keeping-results"><em>Keeping Results</em></a> for more information.</p>
</div></blockquote>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">include</span></tt> argument is a list of modules to import when
the worker starts.  We need to add our tasks module here so
that the worker is able to find our tasks.</p>
</li>
</ul>
</div>
<div class="section" id="proj-tasks-py">
<h4><tt class="file docutils literal"><span class="pre">proj/tasks.py</span></tt><a class="headerlink" href="#proj-tasks-py" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">from</span> <span class="nn">proj.celery</span> <span class="kn">import</span> <span class="n">celery</span>


<span class="nd">@celery.task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>


<span class="nd">@celery.task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>


<span class="nd">@celery.task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">xsum</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="starting-the-worker">
<h3>Starting the worker<a class="headerlink" href="#starting-the-worker" title="Permalink to this headline">¶</a></h3>
<p>The <strong class="program">celery</strong> program can be used to start the worker:</p>
<div class="highlight-python"><pre>$ celery worker --app=proj -l info</pre>
</div>
<p>When the worker starts you should see a banner and some messages:</p>
<div class="highlight-python"><pre>-------------- celery@halcyon.local v2.6.0rc4
---- **** -----
--- * ***  * -- [Configuration]
-- * - **** --- . broker:      amqp://guest@localhost:5672//
- ** ---------- . app:         __main__:0x1012d8590
- ** ---------- . concurrency: 8 (processes)
- ** ---------- . events:      OFF (enable -E to monitor this worker)
- ** ----------
- *** --- * --- [Queues]
-- ******* ---- . celery:      exchange:celery(direct) binding:celery
--- ***** -----

[2012-06-08 16:23:51,078: WARNING/MainProcess] celery@halcyon.local has started.</pre>
</div>
<p>&#8211; The <em>broker</em> is the URL you specifed in the broker argument in our <tt class="docutils literal"><span class="pre">celery</span></tt>
module, you can also specify a different broker on the command line by using
the <a class="reference internal" href="../reference/celery.bin.base.html#cmdoption-b"><em class="xref std std-option">-b</em></a> option.</p>
<p>&#8211; <em>Concurrency</em> is the number of multiprocessing worker process used
to process your tasks concurrently, when all of these are busy doing work
new tasks will have to wait for one of the tasks to finish before
it can be processed.</p>
<p>The default concurrency number is the number of CPU&#8217;s on that machine
(including cores), you can specify a custom number using <em class="xref std std-option">-c</em> option.
There is no recommended value, as the optimal number depends on a number of
factors, but if your tasks are mostly I/O-bound then you can try to increase
it, experimentation has shown that adding more than twice the number
of CPU&#8217;s is rarely effective, and likely to degrade performance
instead.</p>
<p>Including the default multiprocessing pool, Celery also supports using
Eventlet, Gevent, and threads (see <a class="reference internal" href="../userguide/concurrency/index.html#concurrency"><em>Concurrency</em></a>).</p>
<p>&#8211; <em>Events</em> is an option that when enabled causes Celery to send
monitoring messages (events) for actions occurring in the worker.
These can be used by monitor programs like <tt class="docutils literal"><span class="pre">celery</span> <span class="pre">events</span></tt>,
celerymon and the Django-Celery admin monitor that you can read
about in the <a class="reference internal" href="../userguide/monitoring.html#guide-monitoring"><em>Monitoring and Management guide</em></a>.</p>
<p>&#8211; <em>Queues</em> is the list of queues that the worker will consume
tasks from.  The worker can be told to consume from several queues
at once, and this is used to route messages to specific workers
as a means for Quality of Service, separation of concerns,
and emulating priorities, all described in the <a class="reference internal" href="../userguide/routing.html#guide-routing"><em>Routing Guide</em></a>.</p>
<p>You can get a complete list of command line arguments
by passing in the <cite>&#8211;help</cite> flag:</p>
<div class="highlight-python"><pre>$ celery worker --help</pre>
</div>
<p>These options are described in more detailed in the <a class="reference internal" href="../userguide/workers.html#guide-workers"><em>Workers Guide</em></a>.</p>
<div class="sidebar">
<p class="first sidebar-title">About the <em class="xref std std-option">--app</em> argument</p>
<p>The <em class="xref std std-option">--app</em> argument specifies the Celery app instance to use,
it must be in the form of <tt class="docutils literal"><span class="pre">module.path:celery</span></tt>, where the part before the colon
is the name of the module, and the attribute name comes last.
If a package name is specified instead it will automatically
try to find a <tt class="docutils literal"><span class="pre">celery</span></tt> module in that package, and if the name
is a module it will try to find a <tt class="docutils literal"><span class="pre">celery</span></tt> attribute in that module.
This means that these are all equal:</p>
<blockquote class="last">
<div>$ celery &#8211;app=proj
$ celery &#8211;app=proj.celery:
$ celery &#8211;app=proj.celery:celery</div></blockquote>
</div>
</div>
</div>
<div class="section" id="canvas-designing-workflows">
<span id="designing-workflows"></span><h2><a class="toc-backref" href="#id3"><em>Canvas</em>: Designing Workflows</a><a class="headerlink" href="#canvas-designing-workflows" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="../index.html">
  <img class="logo" src="http://cloud.github.com/downloads/celery/celery/celery_128.png" alt="Logo"/>
</a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="first-steps-with-celery.html"
                        title="previous chapter">First Steps with Celery</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="resources.html"
                        title="next chapter">Resources</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/getting-started/next-steps.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="resources.html" title="Resources"
             >next</a> |</li>
        <li class="right" >
          <a href="first-steps-with-celery.html" title="First Steps with Celery"
             >previous</a> |</li>
        <li><a href="../index.html">Celery 2.6.0rc5 documentation</a> &raquo;</li>
          <li><a href="index.html" >Getting Started</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 2009-2012, Ask Solem &amp; Contributors.
    </div>
  </body>
</html>