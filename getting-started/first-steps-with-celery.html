<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>First steps with Celery &mdash; Celery 2.6.0a1 documentation</title>
    
    <link rel="stylesheet" href="../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/issuetracker.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.6.0a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Celery 2.6.0a1 documentation" href="../index.html" />
    <link rel="up" title="Getting Started" href="index.html" />
    <link rel="next" title="Resources" href="resources.html" />
    <link rel="prev" title="Using Beanstalk" href="brokers/beanstalk.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="resources.html" title="Resources"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="brokers/beanstalk.html" title="Using Beanstalk"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Celery 2.6.0a1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Getting Started</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
<div class="deck">

    
        <p class="developmentversion">
        This document is for Celery's development version, which can be
        significantly different from previous releases. Get old docs here:

        <a href="http://docs.celeryproject.org/en/latest/getting-started/first-steps-with-celery.html">2.5</a>.
        </p>
        

</div>
    <div class="section" id="first-steps-with-celery">
<span id="tut-celery"></span><h1>First steps with Celery<a class="headerlink" href="#first-steps-with-celery" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#choosing-a-broker" id="id1">Choosing a Broker</a></li>
<li><a class="reference internal" href="#application" id="id2">Application</a></li>
<li><a class="reference internal" href="#running-the-celery-worker-server" id="id3">Running the celery worker server</a></li>
<li><a class="reference internal" href="#executing-the-task" id="id4">Executing the task</a><ul>
<li><a class="reference internal" href="#keeping-results" id="id5">Keeping Results</a></li>
<li><a class="reference internal" href="#configuration" id="id6">Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#where-to-go-from-here" id="id7">Where to go from here</a></li>
</ul>
</div>
<div class="section" id="choosing-a-broker">
<span id="celerytut-broker"></span><h2><a class="toc-backref" href="#id1">Choosing a Broker</a><a class="headerlink" href="#choosing-a-broker" title="Permalink to this headline">¶</a></h2>
<p>Celery requires a solution to send and receive messages, usually this
comes in the form of a separate service called a <em>message broker</em>.</p>
<p>There are several choices available, including:</p>
<ul class="simple">
<li><a class="reference internal" href="brokers/rabbitmq.html#broker-rabbitmq"><em>Using RabbitMQ</em></a></li>
</ul>
<p><a class="reference external" href="http://www.rabbitmq.com/">RabbitMQ</a> is feature-complete, stable, durable and easy to install.</p>
<ul class="simple">
<li><a class="reference internal" href="brokers/redis.html#broker-redis"><em>Using Redis</em></a></li>
</ul>
<p><a class="reference external" href="http://redis.io/">Redis</a> is also feature-complete, but is more susceptible to data loss in
the event of abrupt termination or power failures.</p>
<ul class="simple">
<li><a class="reference internal" href="brokers/sqlalchemy.html#broker-sqlalchemy"><em>Using SQLAlchemy</em></a></li>
<li><a class="reference internal" href="brokers/django.html#broker-django"><em>Using the Django Database</em></a></li>
</ul>
<p>Using a database as a message queue is not recommended, but can be sufficient
for very small installations.  Celery can use the SQLAlchemy and Django ORM.</p>
<ul class="simple">
<li>and more.</li>
</ul>
<p>In addition to the above, there are several other transport implementations
to choose from, including <a class="reference internal" href="brokers/couchdb.html#broker-couchdb"><em>Using CouchDB</em></a>, <a class="reference internal" href="brokers/beanstalk.html#broker-beanstalk"><em>Using Beanstalk</em></a>,
<a class="reference internal" href="brokers/mongodb.html#broker-mongodb"><em>Using MongoDB</em></a>, and SQS.  There is a <a class="reference external" href="http://kombu.rtfd.org/transport-comparison">Transport Comparison</a>
in the Kombu documentation.</p>
</div>
<div class="section" id="application">
<span id="celerytut-conf"></span><h2><a class="toc-backref" href="#id2">Application</a><a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h2>
<p>The first thing you need is a Celery instance, this is called the celery
application or just app.  Since this instance is used as
the entry-point for everything you want to do in Celery, like creating tasks and
managing workers, it must be possible for other modules to import it.</p>
<p>Some people create a dedicated module for it, but in this tutorial we will
keep everything in the same module.</p>
<p>Let&#8217;s create the file <tt class="file docutils literal"><span class="pre">tasks.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">Celery</span>

<span class="n">celery</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="s">&quot;tasks&quot;</span><span class="p">,</span> <span class="n">broker</span><span class="o">=</span><span class="s">&quot;amqp://guest:guest@localhost:5672&quot;</span><span class="p">)</span>

<span class="nd">@celery.task</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">celery</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>The first argument to <tt class="xref py py-class docutils literal"><span class="pre">Celery</span></tt> is the name of the current module,
this is needed to that names can be automatically generated, the second
argument is the broker keyword argument which specifies the URL of the
message broker we want to use.</p>
<p>We defined a single task, called <tt class="docutils literal"><span class="pre">add</span></tt>, which returns the sum of two numbers.</p>
</div>
<div class="section" id="running-the-celery-worker-server">
<span id="celerytut-running-celeryd"></span><h2><a class="toc-backref" href="#id3">Running the celery worker server</a><a class="headerlink" href="#running-the-celery-worker-server" title="Permalink to this headline">¶</a></h2>
<p>We can now run the worker by executing our program with the <tt class="docutils literal"><span class="pre">worker</span></tt>
argument:</p>
<div class="highlight-python"><pre>$ python tasks.py worker --loglevel=INFO</pre>
</div>
<p>In production you will probably want to run the worker in the
background as a daemon.  To do this you need to use the tools provided
by your platform, or something like <a class="reference external" href="http://supervisord.org">supervisord</a> (see <a class="reference internal" href="../cookbook/daemonizing.html#daemonizing"><em>Running celeryd as a daemon</em></a>
for more information).</p>
<p>For a complete listing of the command line options available, do:</p>
<div class="highlight-python"><pre>$  python tasks.py worker --help</pre>
</div>
<p>There also several other commands available, and similarly you can get a list
of these:</p>
<div class="highlight-python"><pre>$ python tasks.py --help</pre>
</div>
</div>
<div class="section" id="executing-the-task">
<span id="celerytut-executing-task"></span><h2><a class="toc-backref" href="#id4">Executing the task</a><a class="headerlink" href="#executing-the-task" title="Permalink to this headline">¶</a></h2>
<p>Whenever we want to execute our task, we use the
<tt class="xref py py-meth docutils literal"><span class="pre">delay()</span></tt> method of the task class.</p>
<p>This is a handy shortcut to the <tt class="xref py py-meth docutils literal"><span class="pre">apply_async()</span></tt>
method which gives greater control of the task execution (see
<a class="reference internal" href="../userguide/executing.html#guide-executing"><em>Executing Tasks</em></a>).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">tasks</span> <span class="kn">import</span> <span class="n">add</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>The task should now be executed by the worker you started earlier,
and you can verify that by looking at the workers console output.</p>
<p>Applying a task returns an <a class="reference internal" href="../reference/celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><tt class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></tt></a> instance,
which can be used to check the state of the task, wait for the task to finish
or get its return value (or if the task failed, the exception and traceback).
But this isn&#8217;t enabled by default, and you have to configure Celery to
use a result backend, which is detailed in the next section.</p>
<div class="section" id="keeping-results">
<span id="celerytut-keeping-results"></span><h3><a class="toc-backref" href="#id5">Keeping Results</a><a class="headerlink" href="#keeping-results" title="Permalink to this headline">¶</a></h3>
<p>If you want to keep track of the tasks state, Celery needs to store or send
the states somewhere.  There are several
built-in backends to choose from: SQLAlchemy/Django ORM, Memcached, Redis,
AMQP, MongoDB, Tokyo Tyrant and Redis &#8211; or you can define your own.</p>
<p>For this example we will use the <cite>amqp</cite> result backend, which sends states
as messages.  The backend is configured via the <a class="reference internal" href="../configuration.html#std:setting-CELERY_RESULT_BACKEND"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_RESULT_BACKEND</span></tt></a>
setting or using the <tt class="docutils literal"><span class="pre">backend</span></tt> argument to <tt class="xref py py-class docutils literal"><span class="pre">Celery</span></tt>, in addition individual
result backends may have additional settings
you can configure:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery.backends.amqp</span> <span class="kn">import</span> <span class="n">AMQPBackend</span>

<span class="n">celery</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="n">AMQPBackend</span><span class="p">(</span><span class="n">expires</span><span class="o">=</span><span class="mi">300</span><span class="p">))</span>
</pre></div>
</div>
<p>To read more about result backends please see <a class="reference internal" href="../userguide/tasks.html#task-result-backends"><em>Result Backends</em></a>.</p>
<p>Now with the result backend configured, let&#8217;s execute the task again.
This time we&#8217;ll hold on to the <a class="reference internal" href="../reference/celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><tt class="xref py py-class docutils literal"><span class="pre">AsyncResult</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>Here&#8217;s some examples of what you can do when you have results:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">ready</span><span class="p">()</span> <span class="c"># returns True if the task has finished processing.</span>
<span class="go">False</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">result</span> <span class="c"># task is not ready, so no return value yet.</span>
<span class="go">None</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>   <span class="c"># Waits until the task is done and returns the retval.</span>
<span class="go">8</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">result</span> <span class="c"># direct access to result, doesn&#39;t re-raise errors.</span>
<span class="go">8</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">successful</span><span class="p">()</span> <span class="c"># returns True if the task didn&#39;t end in failure.</span>
<span class="go">True</span>
</pre></div>
</div>
<p>If the task raises an exception, the return value of <cite>result.successful()</cite>
will be <tt class="xref py py-const docutils literal"><span class="pre">False</span></tt>, and <cite>result.result</cite> will contain the exception instance
raised by the task.</p>
</div>
<div class="section" id="configuration">
<span id="celerytut-configuration"></span><h3><a class="toc-backref" href="#id6">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>Celery is very flexible and comes with many configuration options that
can be set on your app directly, or by using dedicated configuration files.</p>
<p>For example you can set the default value for the workers
<tt class="docutils literal"><span class="pre">--concurrency</span></tt> argument, which is used to decide the number of pool worker
processes, the name for this setting is <a class="reference internal" href="../configuration.html#std:setting-CELERYD_CONCURRENCY"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_CONCURRENCY</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">celery</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">CELERY_CONCURRENCY</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<p>If you are configuring many settings then one practice is to have a separate module
containing the configuration.  You can tell your Celery instance to use
this module, historically called <tt class="docutils literal"><span class="pre">celeryconfig.py</span></tt>, with the
<tt class="xref py py-meth docutils literal"><span class="pre">config_from_obj()</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">celery</span><span class="o">.</span><span class="n">config_from_object</span><span class="p">(</span><span class="s">&quot;celeryconfig&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For a complete reference of configuration options, see <a class="reference internal" href="../configuration.html#configuration"><em>Configuration and defaults</em></a>.</p>
</div>
</div>
<div class="section" id="where-to-go-from-here">
<h2><a class="toc-backref" href="#id7">Where to go from here</a><a class="headerlink" href="#where-to-go-from-here" title="Permalink to this headline">¶</a></h2>
<p>After this you should read the <a class="reference internal" href="../userguide/index.html#guide"><em>User Guide</em></a>. Specifically
<a class="reference internal" href="../userguide/tasks.html#guide-tasks"><em>Tasks</em></a> and <a class="reference internal" href="../userguide/executing.html#guide-executing"><em>Executing Tasks</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="../index.html">
  <img class="logo" src="http://cloud.github.com/downloads/ask/celery/celery_128.png" alt="Logo"/>
</a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="brokers/beanstalk.html"
                        title="previous chapter">Using Beanstalk</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="resources.html"
                        title="next chapter">Resources</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/getting-started/first-steps-with-celery.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="resources.html" title="Resources"
             >next</a> |</li>
        <li class="right" >
          <a href="brokers/beanstalk.html" title="Using Beanstalk"
             >previous</a> |</li>
        <li><a href="../index.html">Celery 2.6.0a1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Getting Started</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2012, Ask Solem &amp; Contributors.
    </div>
  </body>
</html>