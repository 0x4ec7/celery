<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>What’s new in Celery 3.0 (Chiastic Slide) &mdash; Celery 3.1.0a1 documentation</title>
    
    <link rel="stylesheet" href="_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/issuetracker.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '3.1.0a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="top" title="Celery 3.1.0a1 documentation" href="index.html" />
    <link rel="next" title="What’s new in Celery 2.5" href="whatsnew-2.5.html" />
    <link rel="prev" title="Frequently Asked Questions" href="faq.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="whatsnew-2.5.html" title="What’s new in Celery 2.5"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="faq.html" title="Frequently Asked Questions"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Celery 3.1.0a1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
<div class="deck">

    
        <p class="developmentversion">
        This document is for Celery's development version, which can be
        significantly different from previous releases. Get old docs here:

        <a href="http://docs.celeryproject.org/en/latest/whatsnew-3.0.html">3.0</a>.
        </p>
        

</div>
    <div class="section" id="what-s-new-in-celery-3-0-chiastic-slide">
<span id="whatsnew-3-0"></span><h1>What&#8217;s new in Celery 3.0 (Chiastic Slide)<a class="headerlink" href="#what-s-new-in-celery-3-0-chiastic-slide" title="Permalink to this headline">¶</a></h1>
<p>Celery is a simple, flexible and reliable distributed system to
process vast amounts of messages, while providing operations with
the tools required to maintain such a system.</p>
<p>It&#8217;s a task queue with focus on real-time processing, while also
supporting task scheduling.</p>
<p>Celery has a large and diverse community of users and contributors,
you should come join us <a class="reference internal" href="getting-started/resources.html#irc-channel"><em>on IRC</em></a>
or <a class="reference internal" href="getting-started/resources.html#mailing-list"><em>our mailing-list</em></a>.</p>
<p>To read more about Celery you should go read the <a class="reference internal" href="getting-started/introduction.html#intro"><em>introduction</em></a>.</p>
<p>While this version is backward compatible with previous versions
it&#8217;s important that you read the following section.</p>
<p>If you use Celery in combination with Django you must also
read the <a class="reference external" href="http://github.com/celery/django-celery/tree/master/Changelog">django-celery changelog</a> and upgrade to <a class="reference external" href="http://pypi.python.org/pypi/django-celery/">django-celery 3.0</a>.</p>
<p>This version is officially supported on CPython 2.5, 2.6, 2.7, 3.2 and 3.3,
as well as PyPy and Jython.</p>
<div class="section" id="highlights">
<h2>Highlights<a class="headerlink" href="#highlights" title="Permalink to this headline">¶</a></h2>
<div class="topic">
<p class="topic-title first">Overview</p>
<ul>
<li><p class="first">A new and improved API, that is both simpler and more powerful.</p>
<blockquote>
<div><p>Everyone must read the new <a class="reference internal" href="getting-started/first-steps-with-celery.html#first-steps"><em>First Steps with Celery</em></a> tutorial,
and the new <a class="reference internal" href="getting-started/next-steps.html#next-steps"><em>Next Steps</em></a> tutorial.  Oh, and
why not reread the user guide while you&#8217;re at it :)</p>
<p>There are no current plans to deprecate the old API,
so you don&#8217;t have to be in a hurry to port your applications.</p>
</div></blockquote>
</li>
<li><p class="first">The worker is now thread-less, giving great performance improvements.</p>
</li>
<li><p class="first">The new &#8220;Canvas&#8221; makes it easy to define complex workflows.</p>
<blockquote>
<div><p>Ever wanted to chain tasks together? This is possible, but
not just that, now you can even chain together groups and chords,
or even combine multiple chains.</p>
<p>Read more in the <a class="reference internal" href="userguide/canvas.html#guide-canvas"><em>Canvas</em></a> user guide.</p>
</div></blockquote>
</li>
<li><p class="first">All of Celery&#8217;s command line programs are now available from a single
<strong class="program">celery</strong> umbrella command.</p>
</li>
<li><p class="first">This is the last version to support Python 2.5.</p>
<blockquote>
<div><p>Starting with Celery 3.1, Python 2.6 or later is required.</p>
</div></blockquote>
</li>
<li><p class="first">Support for the new librabbitmq C client.</p>
<blockquote>
<div><p>Celery will automatically use the <tt class="xref py py-mod docutils literal"><span class="pre">librabbitmq</span></tt> module
if installed, which is a very fast and memory-optimized
replacement for the amqplib module.</p>
</div></blockquote>
</li>
<li><p class="first">Redis support is more reliable with improved ack emulation.</p>
</li>
<li><p class="first">Celery now always uses UTC</p>
</li>
<li><p class="first">Over 600 commits, 30k additions/36k deletions.</p>
<blockquote>
<div><p>In comparison 1.0➝ 2.0 had 18k additions/8k deletions.</p>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="important-notes">
<span id="v300-important"></span><h2>Important Notes<a class="headerlink" href="#important-notes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="broadcast-exchanges-renamed">
<h3>Broadcast exchanges renamed<a class="headerlink" href="#broadcast-exchanges-renamed" title="Permalink to this headline">¶</a></h3>
<p>The workers remote control command exchanges has been renamed
(a new pidbox name), this is because the <tt class="docutils literal"><span class="pre">auto_delete</span></tt> flag on the exchanges
has been removed, and that makes it incompatible with earlier versions.</p>
<p>You can manually delete the old exchanges if you want,
using the <strong class="program">celery amqp</strong> command (previously called <tt class="docutils literal"><span class="pre">camqadm</span></tt>):</p>
<div class="highlight-python"><pre>$ celery amqp exchange.delete celeryd.pidbox
$ celery amqp exchange.delete reply.celeryd.pidbox</pre>
</div>
</div>
<div class="section" id="eventloop">
<h3>Eventloop<a class="headerlink" href="#eventloop" title="Permalink to this headline">¶</a></h3>
<p>The worker is now running <em>without threads</em> when used with RabbitMQ (AMQP),
or Redis as a broker, resulting in:</p>
<ul class="simple">
<li>Much better overall performance.</li>
<li>Fixes several edge case race conditions.</li>
<li>Sub-millisecond timer precision.</li>
<li>Faster shutdown times.</li>
</ul>
<p>The transports supported are:  <tt class="docutils literal"><span class="pre">amqplib</span></tt>, <tt class="docutils literal"><span class="pre">librabbitmq</span></tt>, and <tt class="docutils literal"><span class="pre">redis</span></tt>
Hopefully this can be extended to include additional broker transports
in the future.</p>
<p>For increased reliability the <tt class="xref std std-setting docutils literal"><span class="pre">CELERY_FORCE_EXECV</span></tt> setting is enabled
by default if the eventloop is not used.</p>
</div>
<div class="section" id="new-celery-umbrella-command">
<h3>New <tt class="docutils literal"><span class="pre">celery</span></tt> umbrella command<a class="headerlink" href="#new-celery-umbrella-command" title="Permalink to this headline">¶</a></h3>
<p>All Celery&#8217;s command line programs are now available from a single
<strong class="program">celery</strong> umbrella command.</p>
<p>You can see a list of subcommands and options by running:</p>
<div class="highlight-python"><pre>$ celery help</pre>
</div>
<p>Commands include:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">celery</span> <span class="pre">worker</span></tt>  (previously <tt class="docutils literal"><span class="pre">celeryd</span></tt>).</li>
<li><tt class="docutils literal"><span class="pre">celery</span> <span class="pre">beat</span></tt>    (previously <tt class="docutils literal"><span class="pre">celerybeat</span></tt>).</li>
<li><tt class="docutils literal"><span class="pre">celery</span> <span class="pre">amqp</span></tt>    (previously <tt class="docutils literal"><span class="pre">camqadm</span></tt>).</li>
</ul>
<p>The old programs are still available (<tt class="docutils literal"><span class="pre">celeryd</span></tt>, <tt class="docutils literal"><span class="pre">celerybeat</span></tt>, etc),
but you are discouraged from using them.</p>
</div>
<div class="section" id="now-depends-on-billiard">
<h3>Now depends on <tt class="xref py py-mod docutils literal"><span class="pre">billiard</span></tt>.<a class="headerlink" href="#now-depends-on-billiard" title="Permalink to this headline">¶</a></h3>
<p>Billiard is a fork of the multiprocessing containing
the no-execv patch by sbt (<a class="reference external" href="http://bugs.python.org/issue8713">http://bugs.python.org/issue8713</a>),
and also contains the pool improvements previously located in Celery.</p>
<p>This fork was necessary as changes to the C extension code was required
for the no-execv patch to work.</p>
<ul class="simple">
<li>Issue <span class="xref issue">#625</span></li>
<li>Issue <span class="xref issue">#627</span></li>
<li>Issue <span class="xref issue">#640</span></li>
<li><cite>django-celery <span class="xref issue">#122</span> &lt;http://github.com/celery/django-celery/issues/122</cite></li>
<li><cite>django-celery <span class="xref issue">#124</span> &lt;http://github.com/celery/django-celery/issues/122</cite></li>
</ul>
</div>
<div class="section" id="celery-app-task-no-longer-a-package">
<h3><a class="reference internal" href="reference/celery.app.task.html#module-celery.app.task" title="celery.app.task"><tt class="xref py py-mod docutils literal"><span class="pre">celery.app.task</span></tt></a> no longer a package<a class="headerlink" href="#celery-app-task-no-longer-a-package" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="reference/celery.app.task.html#module-celery.app.task" title="celery.app.task"><tt class="xref py py-mod docutils literal"><span class="pre">celery.app.task</span></tt></a> module is now a module instead of a package.</p>
<p>The setup.py install script will try to remove the old package,
but if that doesn&#8217;t work for some reason you have to remove
it manually.  This command helps:</p>
<div class="highlight-python"><pre>$ rm -r $(dirname $(python -c '
    import celery;print(celery.__file__)'))/app/task/</pre>
</div>
<p>If you experience an error like <tt class="docutils literal"><span class="pre">ImportError:</span> <span class="pre">cannot</span> <span class="pre">import</span> <span class="pre">name</span> <span class="pre">_unpickle_task</span></tt>,
you just have to remove the old package and everything is fine.</p>
</div>
<div class="section" id="last-version-to-support-python-2-5">
<h3>Last version to support Python 2.5<a class="headerlink" href="#last-version-to-support-python-2-5" title="Permalink to this headline">¶</a></h3>
<p>The 3.0 series will be last version to support Python 2.5,
and starting from 3.1 Python 2.6 and later will be required.</p>
<p>With several other distributions taking the step to discontinue
Python 2.5 support, we feel that it is time too.</p>
<p>Python 2.6 should be widely available at this point, and we urge
you to upgrade, but if that is not possible you still have the option
to continue using the Celery 3.0, and important bug fixes
introduced in Celery 3.1 will be back-ported to Celery 3.0 upon request.</p>
</div>
<div class="section" id="utc-timezone-is-now-used">
<h3>UTC timezone is now used<a class="headerlink" href="#utc-timezone-is-now-used" title="Permalink to this headline">¶</a></h3>
<p>This means that ETA/countdown in messages are not compatible with Celery
versions prior to 2.5.</p>
<p>You can disable UTC and revert back to old local time by setting
the <a class="reference internal" href="configuration.html#std:setting-CELERY_ENABLE_UTC"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_ENABLE_UTC</span></tt></a> setting.</p>
</div>
<div class="section" id="redis-ack-emulation-improvements">
<h3>Redis: Ack emulation improvements<a class="headerlink" href="#redis-ack-emulation-improvements" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Reducing the possibility of data loss.</p>
<p>Acks are now implemented by storing a copy of the message when the message
is consumed.  The copy is not removed until the consumer acknowledges
or rejects it.</p>
<p>This means that unacknowledged messages will be redelivered either
when the connection is closed, or when the visibility timeout is exceeded.</p>
<ul>
<li><p class="first">Visibility timeout</p>
<blockquote>
<div><p>This is a timeout for acks, so that if the consumer
does not ack the message within this time limit, the message
is redelivered to another consumer.</p>
<p>The timeout is set to one hour by default, but
can be changed by configuring a transport option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">BROKER_TRANSPORT_OPTIONS</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;visibility_timeout&#39;</span><span class="p">:</span> <span class="mi">18000</span><span class="p">}</span>  <span class="c"># 5 hours</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Messages that have not been acked will be redelivered
if the visibility timeout is exceeded, for Celery users
this means that ETA/countdown tasks that are scheduled to execute
with a time that exceeds the visibility timeout will be executed
twice (or more).  If you plan on using long ETA/countdowns you
should tweak the visibility timeout accordingly.</p>
</div>
<p>Setting a long timeout means that it will take a long time
for messages to be redelivered in the event of a power failure,
but if so happens you could temporarily set the visibility timeout lower
to flush out messages when you start up the systems again.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="news">
<span id="v300-news"></span><h2>News<a class="headerlink" href="#news" title="Permalink to this headline">¶</a></h2>
<div class="section" id="chaining-tasks">
<h3>Chaining Tasks<a class="headerlink" href="#chaining-tasks" title="Permalink to this headline">¶</a></h3>
<p>Tasks can now have callbacks and errbacks, and dependencies are recorded</p>
<ul>
<li><p class="first">The task message format have been updated with two new extension keys</p>
<blockquote>
<div><p>Both keys can be empty/undefined or a list of subtasks.</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">callbacks</span></tt></p>
<blockquote>
<div><p>Applied if the task exits successfully, with the result
of the task as an argument.</p>
</div></blockquote>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">errbacks</span></tt></p>
<blockquote>
<div><p>Applied if an error occurred while executing the task,
with the uuid of the task as an argument.  Since it may not be possible
to serialize the exception instance, it passes the uuid of the task
instead.  The uuid can then be used to retrieve the exception and
traceback of the task from the result backend.</p>
</div></blockquote>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">link</span></tt> and <tt class="docutils literal"><span class="pre">link_error</span></tt> keyword arguments has been added
to <tt class="docutils literal"><span class="pre">apply_async</span></tt>.</p>
<blockquote>
<div><p>These add callbacks and errbacks to the task, and
you can read more about them at <a class="reference internal" href="userguide/calling.html#calling-links"><em>Linking (callbacks/errbacks)</em></a>.</p>
</div></blockquote>
</li>
<li><p class="first">We now track what subtasks a task sends, and some result backends
supports retrieving this information.</p>
<blockquote>
<div><blockquote>
<div><ul>
<li><p class="first">task.request.children</p>
<blockquote>
<div><p>Contains the result instances of the subtasks
the currently executing task has applied.</p>
</div></blockquote>
</li>
<li><p class="first">AsyncResult.children</p>
<blockquote>
<div><p>Returns the tasks dependencies, as a list of
<tt class="docutils literal"><span class="pre">AsyncResult</span></tt>/<tt class="docutils literal"><span class="pre">ResultSet</span></tt> instances.</p>
</div></blockquote>
</li>
<li><p class="first">AsyncResult.iterdeps</p>
<blockquote>
<div><p>Recursively iterates over the tasks dependencies,
yielding <cite>(parent, node)</cite> tuples.</p>
<p>Raises IncompleteStream if any of the dependencies
has not returned yet.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<ul>
<li><p class="first">AsyncResult.graph</p>
<blockquote>
<div><p>A <tt class="docutils literal"><span class="pre">DependencyGraph</span></tt> of the tasks dependencies.
This can also be used to convert to dot format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;graph.dot&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
    <span class="n">result</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">to_dot</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
</pre></div>
</div>
<p>which can than be used to produce an image:</p>
<div class="highlight-python"><pre>$ dot -Tpng graph.dot -o graph.png</pre>
</div>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">A new special subtask called <tt class="docutils literal"><span class="pre">chain</span></tt> is also included:</p>
<div class="highlight-python"><pre>.. code-block:: python

    &gt;&gt;&gt; from celery import chain

    # (2 + 2) * 8 / 2
    &gt;&gt;&gt; res = chain(add.subtask((2, 2)),
                    mul.subtask((8, )),
                    div.subtask((2,))).apply_async()
    &gt;&gt;&gt; res.get() == 16

    &gt;&gt;&gt; res.parent.get() == 32

    &gt;&gt;&gt; res.parent.parent.get() == 4</pre>
</div>
</li>
<li><p class="first">Adds <tt class="xref py py-meth docutils literal"><span class="pre">AsyncResult.get_leaf()</span></tt></p>
<blockquote>
<div><p>Waits and returns the result of the leaf subtask.
That is the last node found when traversing the graph,
but this means that the graph can be 1-dimensional only (in effect
a list).</p>
</div></blockquote>
</li>
<li><p class="first">Adds <tt class="docutils literal"><span class="pre">subtask.link(subtask)</span></tt> + <tt class="docutils literal"><span class="pre">subtask.link_error(subtask)</span></tt></p>
<blockquote>
<div><p>Shortcut to <tt class="docutils literal"><span class="pre">s.options.setdefault('link',</span> <span class="pre">[]).append(subtask)</span></tt></p>
</div></blockquote>
</li>
<li><p class="first">Adds <tt class="docutils literal"><span class="pre">subtask.flatten_links()</span></tt></p>
<blockquote>
<div><p>Returns a flattened list of all dependencies (recursively)</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="redis-priority-support">
<h3>Redis: Priority support.<a class="headerlink" href="#redis-priority-support" title="Permalink to this headline">¶</a></h3>
<p>The message&#8217;s <tt class="docutils literal"><span class="pre">priority</span></tt> field is now respected by the Redis
transport by having multiple lists for each named queue.
The queues are then consumed by in order of priority.</p>
<p>The priority field is a number in the range of 0 - 9, where
0 is the default and highest priority.</p>
<p>The priority range is collapsed into four steps by default, since it is
unlikely that nine steps will yield more benefit than using four steps.
The number of steps can be configured by setting the <tt class="docutils literal"><span class="pre">priority_steps</span></tt>
transport option, which must be a list of numbers in <strong>sorted order</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">BROKER_TRANSPORT_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s">&#39;priority_steps&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
<span class="gp">... </span><span class="p">}</span>
</pre></div>
</div>
<p>Priorities implemented in this way is not as reliable as
priorities on the server side, which is why
nickname the feature &#8220;quasi-priorities&#8221;;
<strong>Using routing is still the suggested way of ensuring
quality of service</strong>, as client implemented priorities
fall short in a number of ways, e.g. if the worker
is busy with long running tasks, has prefetched many messages,
or the queues are congested.</p>
<p>Still, it is possible that using priorities in combination
with routing can be more beneficial than using routing
or priorities alone.  Experimentation and monitoring
should be used to prove this.</p>
<p>Contributed by Germán M. Bravo.</p>
</div>
<div class="section" id="redis-now-cycles-queues-so-that-consuming-is-fair">
<h3>Redis: Now cycles queues so that consuming is fair.<a class="headerlink" href="#redis-now-cycles-queues-so-that-consuming-is-fair" title="Permalink to this headline">¶</a></h3>
<p>This ensures that a very busy queue won&#8217;t block messages
from other queues, and ensures that all queues have
an equal chance of being consumed from.</p>
<p>This used to be the case before, but the behavior was
accidentally changed while switching to using blocking pop.</p>
</div>
<div class="section" id="group-chord-chain-are-now-subtasks">
<h3><cite>group</cite>/<cite>chord</cite>/<cite>chain</cite> are now subtasks<a class="headerlink" href="#group-chord-chain-are-now-subtasks" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">group is no longer an alias to TaskSet, but new alltogether,
since it was very difficult to migrate the TaskSet class to become
a subtask.</p>
</li>
<li><p class="first">A new shortcut has been added to tasks:</p>
<div class="highlight-python"><pre>    &gt;&gt;&gt; task.s(arg1, arg2, kw=1)

as a shortcut to::

    &gt;&gt;&gt; task.subtask((arg1, arg2), {'kw': 1})</pre>
</div>
</li>
<li><p class="first">Tasks can be chained by using the <tt class="docutils literal"><span class="pre">|</span></tt> operator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">pow</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">apply_async</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first">Subtasks can be &#8220;evaluated&#8221; using the <tt class="docutils literal"><span class="pre">~</span></tt> operator:</p>
<div class="highlight-python"><pre>    &gt;&gt;&gt; ~add.s(2, 2)
    4

    &gt;&gt;&gt; ~(add.s(2, 2) | pow.s(2))

is the same as::

    &gt;&gt;&gt; chain(add.s(2, 2), pow.s(2)).apply_async().get()</pre>
</div>
</li>
<li><p class="first">A new subtask_type key has been added to the subtask dicts</p>
<blockquote>
<div><p>This can be the string &#8220;chord&#8221;, &#8220;group&#8221;, &#8220;chain&#8221;, &#8220;chunks&#8221;,
&#8220;xmap&#8221;, or &#8220;xstarmap&#8221;.</p>
</div></blockquote>
</li>
<li><p class="first">maybe_subtask now uses subtask_type to reconstruct
the object, to be used when using non-pickle serializers.</p>
</li>
<li><p class="first">The logic for these operations have been moved to dedicated
tasks celery.chord, celery.chain and celery.group.</p>
</li>
<li><p class="first">subtask no longer inherits from AttributeDict.</p>
<blockquote>
<div><p>It&#8217;s now a pure dict subclass with properties for attribute
access to the relevant keys.</p>
</div></blockquote>
</li>
<li><p class="first">The repr&#8217;s now outputs how the sequence would like imperatively:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">chord</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">chord</span><span class="p">([</span><span class="n">add</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">)],</span> <span class="n">xsum</span><span class="o">.</span><span class="n">s</span><span class="p">())</span>
<span class="go">      | pow.s(2))</span>
<span class="go">tasks.xsum([tasks.add(0, 0),</span>
<span class="go">            tasks.add(1, 1),</span>
<span class="go">            tasks.add(2, 2),</span>
<span class="go">            tasks.add(3, 3),</span>
<span class="go">            tasks.add(4, 4),</span>
<span class="go">            tasks.add(5, 5),</span>
<span class="go">            tasks.add(6, 6),</span>
<span class="go">            tasks.add(7, 7),</span>
<span class="go">            tasks.add(8, 8),</span>
<span class="go">            tasks.add(9, 9)]) | tasks.pow(2)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="new-remote-control-commands">
<h3>New remote control commands<a class="headerlink" href="#new-remote-control-commands" title="Permalink to this headline">¶</a></h3>
<p>These commands were previously experimental, but they have proven
stable and is now documented as part of the offical API.</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">add_consumer</span></tt>/<tt class="docutils literal"><span class="pre">cancel_consumer</span></tt></p>
<blockquote>
<div><p>Tells workers to consume from a new queue, or cancel consuming from a
queue.  This command has also been changed so that the worker remembers
the queues added, so that the change will persist even if
the connection is re-connected.</p>
<p>These commands are available programmatically as
<a class="reference internal" href="reference/celery.app.control.html#celery.app.control.Control.add_consumer" title="celery.app.control.Control.add_consumer"><tt class="xref py py-meth docutils literal"><span class="pre">celery.control.add_consumer()</span></tt></a> / <a class="reference internal" href="reference/celery.app.control.html#celery.app.control.Control.cancel_consumer" title="celery.app.control.Control.cancel_consumer"><tt class="xref py py-meth docutils literal"><span class="pre">celery.control.cancel_consumer()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">celery</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">add_consumer</span><span class="p">(</span><span class="n">queue_name</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">destination</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;w1.example.com&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">celery</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">cancel_consumer</span><span class="p">(</span><span class="n">queue_name</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">destination</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;w1.example.com&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>or using the <strong class="program">celery control</strong> command:</p>
<div class="highlight-python"><pre>$ celery control -d w1.example.com add_consumer queue
$ celery control -d w1.example.com cancel_consumer queue</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember that a control command without <em>destination</em> will be
sent to <strong>all workers</strong>.</p>
</div>
</div></blockquote>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">autoscale</span></tt></p>
<blockquote>
<div><p>Tells workers with <cite>&#8211;autoscale</cite> enabled to change autoscale
max/min concurrency settings.</p>
<p>This command is available programmatically as <tt class="xref py py-meth docutils literal"><span class="pre">celery.control.autoscale()</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">celery</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">destination</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;w1.example.com&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>or using the <strong class="program">celery control</strong> command:</p>
<div class="highlight-python"><pre>$ celery control -d w1.example.com autoscale 10 5</pre>
</div>
</div></blockquote>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">pool_grow</span></tt>/<tt class="docutils literal"><span class="pre">pool_shrink</span></tt></p>
<blockquote>
<div><p>Tells workers to add or remove pool processes.</p>
<p>These commands are available programmatically as
<a class="reference internal" href="reference/celery.app.control.html#celery.app.control.Control.pool_grow" title="celery.app.control.Control.pool_grow"><tt class="xref py py-meth docutils literal"><span class="pre">celery.control.pool_grow()</span></tt></a> / <a class="reference internal" href="reference/celery.app.control.html#celery.app.control.Control.pool_shrink" title="celery.app.control.Control.pool_shrink"><tt class="xref py py-meth docutils literal"><span class="pre">celery.control.pool_shrink()</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">celery</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">pool_grow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;w1.example.com&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">celery</span><span class="o">.</span><span class="n">contorl</span><span class="o">.</span><span class="n">pool_shrink</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;w1.example.com&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>or using the <strong class="program">celery control</strong> command:</p>
<div class="highlight-python"><pre>$ celery control -d w1.example.com pool_grow 2
$ celery control -d w1.example.com pool_shrink 2</pre>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong class="program">celery control</strong> now supports <tt class="docutils literal"><span class="pre">rate_limit</span></tt> &amp; <tt class="docutils literal"><span class="pre">time_limit</span></tt>
commands.</p>
<blockquote>
<div><p>See <tt class="docutils literal"><span class="pre">celery</span> <span class="pre">control</span> <span class="pre">--help</span></tt> for details.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="crontab-now-supports-day-of-month-and-month-of-year-arguments">
<h3>Crontab now supports Day of Month, and Month of Year arguments<a class="headerlink" href="#crontab-now-supports-day-of-month-and-month-of-year-arguments" title="Permalink to this headline">¶</a></h3>
<p>See the updated list of examples at <a class="reference internal" href="userguide/periodic-tasks.html#beat-crontab"><em>Crontab schedules</em></a>.</p>
</div>
<div class="section" id="immutable-subtasks">
<h3>Immutable subtasks<a class="headerlink" href="#immutable-subtasks" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">subtask</span></tt>&#8216;s can now be immutable, which means that the arguments
will not be modified when calling callbacks:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">chain</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">clear_static_electricity</span><span class="o">.</span><span class="n">si</span><span class="p">())</span>
</pre></div>
</div>
<p>means it will not receive the argument of the parent task,
and <tt class="docutils literal"><span class="pre">.si()</span></tt> is a shortcut to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">clear_static_electricity</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="n">immutable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="logging-improvements">
<h3>Logging Improvements<a class="headerlink" href="#logging-improvements" title="Permalink to this headline">¶</a></h3>
<p>Logging support now conforms better with best practices.</p>
<ul>
<li><p class="first">Classes used by the worker no longer uses app.get_default_logger, but uses
<cite>celery.utils.log.get_logger</cite> which simply gets the logger not setting the
level, and adds a NullHandler.</p>
</li>
<li><p class="first">Loggers are no longer passed around, instead every module using logging
defines a module global logger that is used throughout.</p>
</li>
<li><p class="first">All loggers inherit from a common logger called &#8220;celery&#8221;.</p>
</li>
<li><p class="first">Before task.get_logger would setup a new logger for every task,
and even set the loglevel.  This is no longer the case.</p>
<blockquote>
<div><ul class="simple">
<li>Instead all task loggers now inherit from a common &#8220;celery.task&#8221; logger
that is set up when programs call <cite>setup_logging_subsystem</cite>.</li>
<li>Instead of using LoggerAdapter to augment the formatter with
the task_id and task_name field, the task base logger now use
a special formatter adding these values at runtime from the
currently executing task.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">In fact, <tt class="docutils literal"><span class="pre">task.get_logger</span></tt> is no longer recommended, it is better
to add a module-level logger to your tasks module.</p>
<blockquote>
<div><p>For example, like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery.utils.log</span> <span class="kn">import</span> <span class="n">get_task_logger</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">get_task_logger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@celery.task</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Adding </span><span class="si">%r</span><span class="s"> + </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
<p>The resulting logger will then inherit from the <tt class="docutils literal"><span class="pre">&quot;celery.task&quot;</span></tt> logger
so that the current task name and id is included in logging output.</p>
</div></blockquote>
</li>
<li><p class="first">Redirected output from stdout/stderr is now logged to a &#8220;celery.redirected&#8221;
logger.</p>
</li>
<li><p class="first">In addition a few warnings.warn have been replaced with logger.warn.</p>
</li>
<li><p class="first">Now avoids the &#8216;no handlers for logger multiprocessing&#8217; warning</p>
</li>
</ul>
</div>
<div class="section" id="task-registry-no-longer-global">
<h3>Task registry no longer global<a class="headerlink" href="#task-registry-no-longer-global" title="Permalink to this headline">¶</a></h3>
<p>Every Celery instance now has its own task registry.</p>
<p>You can make apps share registries by specifying it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">app1</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">app2</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="n">tasks</span><span class="o">=</span><span class="n">app1</span><span class="o">.</span><span class="n">tasks</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that tasks are shared between registries by default, so that
tasks will be added to every subsequently created task registry.
As an alternative tasks can be private to specific task registries
by setting the <tt class="docutils literal"><span class="pre">shared</span></tt> argument to the <tt class="docutils literal"><span class="pre">&#64;task</span></tt> decorator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@celery.task</span><span class="p">(</span><span class="n">shared</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</pre></div>
</div>
</div>
<div class="section" id="abstract-tasks-are-now-lazily-bound">
<h3>Abstract tasks are now lazily bound.<a class="headerlink" href="#abstract-tasks-are-now-lazily-bound" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="reference/celery.task.html#celery.task.Task" title="celery.task.Task"><tt class="xref py py-class docutils literal"><span class="pre">Task</span></tt></a> class is no longer bound to an app
by default, it will first be bound (and configured) when
a concrete subclass is created.</p>
<p>This means that you can safely import and make task base classes,
without also initializing the app environment:</p>
<div class="highlight-python"><pre>from celery.task import Task

class DebugTask(Task):
    abstract = True

    def __call__(self, *args, **kwargs):
        print('CALLING %r' % (self, ))
        return self.run(*args, **kwargs)

&gt;&gt;&gt; DebugTask
&lt;unbound DebugTask&gt;

&gt;&gt;&gt; @celery1.task(base=DebugTask)
... def add(x, y):
...     return x + y
&gt;&gt;&gt; add.__class__
&lt;class add of &lt;Celery default:0x101510d10&gt;&gt;</pre>
</div>
</div>
<div class="section" id="lazy-task-decorators">
<h3>Lazy task decorators<a class="headerlink" href="#lazy-task-decorators" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">&#64;task</span></tt> decorator is now lazy when used with custom apps.</p>
<p>That is, if <tt class="docutils literal"><span class="pre">accept_magic_kwargs</span></tt> is enabled (herby called &#8220;compat mode&#8221;), the task
decorator executes inline like before, however for custom apps the &#64;task
decorator now returns a special PromiseProxy object that is only evaluated
on access.</p>
<p>All promises will be evaluated when <cite>app.finalize</cite> is called, or implicitly
when the task registry is first used.</p>
</div>
<div class="section" id="smart-app-option">
<h3>Smart <cite>&#8211;app</cite> option<a class="headerlink" href="#smart-app-option" title="Permalink to this headline">¶</a></h3>
<p>The <em class="xref std std-option">--app</em> option now &#8216;auto-detects&#8217;</p>
<blockquote>
<div><ul class="simple">
<li>If the provided path is a module it tries to get an
attribute named &#8216;celery&#8217;.</li>
<li>If the provided path is a package it tries
to import a submodule named &#8216;celery&#8217;,
and get the celery attribute from that module.</li>
</ul>
</div></blockquote>
<p>E.g. if you have a project named &#8216;proj&#8217; where the
celery app is located in &#8216;from proj.celery import celery&#8217;,
then the following will be equivalent:</p>
<div class="highlight-python"><pre>$ celery worker --app=proj
$ celery worker --app=proj.celery:
$ celery worker --app=proj.celery:celery</pre>
</div>
</div>
<div class="section" id="in-other-news">
<h3>In Other News<a class="headerlink" href="#in-other-news" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">New <a class="reference internal" href="configuration.html#std:setting-CELERYD_WORKER_LOST_WAIT"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYD_WORKER_LOST_WAIT</span></tt></a> to control the timeout in
seconds before <tt class="xref py py-exc docutils literal"><span class="pre">billiard.WorkerLostError</span></tt> is raised
when a worker can not be signalled (Issue <span class="xref issue">#595</span>).</p>
<blockquote>
<div><p>Contributed by Brendon Crawford.</p>
</div></blockquote>
</li>
<li><p class="first">Redis event monitor queues are now automatically deleted (Issue <span class="xref issue">#436</span>).</p>
</li>
<li><p class="first">App instance factory methods have been converted to be cached
descriptors that creates a new subclass on access.</p>
<blockquote>
<div><p>This means that e.g. <tt class="docutils literal"><span class="pre">celery.Worker</span></tt> is an actual class
and will work as expected when:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Worker</span><span class="p">(</span><span class="n">celery</span><span class="o">.</span><span class="n">Worker</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">New signal: <tt class="xref std std-signal docutils literal"><span class="pre">task-success</span></tt>.</p>
</li>
<li><p class="first">Multiprocessing logs are now only emitted if the <span class="target" id="index-0"></span><tt class="xref std std-envvar docutils literal"><span class="pre">MP_LOG</span></tt>
environment variable is set.</p>
</li>
<li><p class="first">The Celery instance can now be created with a broker URL</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">celery</span> <span class="o">=</span> <span class="n">Celery</span><span class="p">(</span><span class="n">broker</span><span class="o">=</span><span class="s">&#39;redis://&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Result backends can now be set using an URL</p>
<blockquote>
<div><p>Currently only supported by redis.  Example use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CELERY_RESULT_BACKEND</span> <span class="o">=</span> <span class="s">&#39;redis://localhost/1&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Heartbeat frequency now every 5s, and frequency sent with event</p>
<blockquote>
<div><p>The heartbeat frequency is now available in the worker event messages,
so that clients can decide when to consider workers offline based on
this value.</p>
</div></blockquote>
</li>
<li><p class="first">Module celery.actors has been removed, and will be part of cl instead.</p>
</li>
<li><p class="first">Introduces new <tt class="docutils literal"><span class="pre">celery</span></tt> command, which is an entrypoint for all other
commands.</p>
<blockquote>
<div><p>The main for this command can be run by calling <tt class="docutils literal"><span class="pre">celery.start()</span></tt>.</p>
</div></blockquote>
</li>
<li><p class="first">Annotations now supports decorators if the key startswith &#8216;&#64;&#8217;.</p>
<blockquote>
<div><p>E.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">debug_args</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;ARGS: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">))</span>
    <span class="k">return</span> <span class="n">_inner</span>

<span class="n">CELERY_ANNOTATIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;tasks.add&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;@__call__&#39;</span><span class="p">:</span> <span class="n">debug_args</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Also tasks are now always bound by class so that
annotated methods end up being bound.</p>
</div></blockquote>
</li>
<li><p class="first">Bugreport now available as a command and broadcast command</p>
<blockquote>
<div><ul>
<li><p class="first">Get it from a Python repl:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">celery</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">celery</span><span class="o">.</span><span class="n">bugreport</span><span class="p">())</span>
</pre></div>
</div>
</li>
<li><p class="first">Using the <tt class="docutils literal"><span class="pre">celery</span></tt> command-line program:</p>
<div class="highlight-python"><pre>$ celery report</pre>
</div>
</li>
<li><p class="first">Get it from remote workers:</p>
<div class="highlight-python"><pre>$ celery inspect report</pre>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Module <tt class="docutils literal"><span class="pre">celery.log</span></tt> moved to <a class="reference internal" href="reference/celery.app.log.html#module-celery.app.log" title="celery.app.log"><tt class="xref py py-mod docutils literal"><span class="pre">celery.app.log</span></tt></a>.</p>
</li>
<li><p class="first">Module <tt class="docutils literal"><span class="pre">celery.task.control</span></tt> moved to <a class="reference internal" href="reference/celery.app.control.html#module-celery.app.control" title="celery.app.control"><tt class="xref py py-mod docutils literal"><span class="pre">celery.app.control</span></tt></a>.</p>
</li>
<li><p class="first">New signal: <tt class="xref std std-signal docutils literal"><span class="pre">task-revoked</span></tt></p>
<blockquote>
<div><p>Sent in the main process when the task is revoked or terminated.</p>
</div></blockquote>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">AsyncResult.task_id</span></tt> renamed to <tt class="docutils literal"><span class="pre">AsyncResult.id</span></tt></p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">TasksetResult.taskset_id</span></tt> renamed to <tt class="docutils literal"><span class="pre">.id</span></tt></p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xmap(task,</span> <span class="pre">sequence)</span></tt> and <tt class="docutils literal"><span class="pre">xstarmap(task,</span> <span class="pre">sequence)</span></tt></p>
<blockquote>
<div><p>Returns a list of the results applying the task function to every item
in the sequence.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">celery</span> <span class="kn">import</span> <span class="n">xstarmap</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">xstarmap</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">apply_async</span><span class="p">()</span>
<span class="go">[0, 2, 4, 6, 8, 10, 12, 14, 16, 18]</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">chunks(task,</span> <span class="pre">sequence,</span> <span class="pre">chunksize)</span></tt></p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">group.skew(start=,</span> <span class="pre">stop=,</span> <span class="pre">step=)</span></tt></p>
<p>Skew will skew the countdown for the individual tasks in a group,
e.g. with a group:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">group</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<p>Skewing the tasks from 0 seconds to 10 seconds:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Will have the first task execute in 0 seconds, the second in 1 second,
the third in 2 seconds and so on.</p>
</li>
<li><p class="first">99% test Coverage</p>
</li>
<li><p class="first"><a class="reference internal" href="configuration.html#std:setting-CELERY_QUEUES"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_QUEUES</span></tt></a> can now be a list/tuple of <tt class="xref py py-class docutils literal"><span class="pre">Queue</span></tt>
instances.</p>
<blockquote>
<div><p>Internally <a class="reference internal" href="reference/celery.app.amqp.html#celery.app.amqp.AMQP.queues" title="celery.app.amqp.AMQP.queues"><tt class="xref py py-attr docutils literal"><span class="pre">celery.amqp.queues</span></tt></a> is now a mapping of name/Queue instances,
instead of converting on the fly.</p>
</div></blockquote>
</li>
<li><p class="first">Can now specify connection for <a class="reference internal" href="reference/celery.app.control.html#celery.app.control.Control.inspect" title="celery.app.control.Control.inspect"><tt class="xref py py-class docutils literal"><span class="pre">celery.control.inspect</span></tt></a>.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">kombu</span> <span class="kn">import</span> <span class="n">Connection</span>

<span class="n">i</span> <span class="o">=</span> <span class="n">celery</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">connection</span><span class="o">=</span><span class="n">Connection</span><span class="p">(</span><span class="s">&#39;redis://&#39;</span><span class="p">))</span>
<span class="n">i</span><span class="o">.</span><span class="n">active_queues</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_FORCE_EXECV</span></tt> is now enabled by default.</p>
<blockquote>
<div><p>If the old behavior is wanted the setting can be set to False,
or the new <em class="xref std std-option">--no-execv</em> to <strong class="program">celery worker</strong>.</p>
</div></blockquote>
</li>
<li><p class="first">Deprecated module <tt class="docutils literal"><span class="pre">celery.conf</span></tt> has been removed.</p>
</li>
<li><p class="first">The <a class="reference internal" href="configuration.html#std:setting-CELERY_TIMEZONE"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TIMEZONE</span></tt></a> now always require the <tt class="xref py py-mod docutils literal"><span class="pre">pytz</span></tt>
library to be installed (exept if the timezone is set to <cite>UTC</cite>).</p>
</li>
<li><p class="first">The Tokyo Tyrant backend has been removed and is no longer supported.</p>
</li>
<li><p class="first">Now uses <a class="reference external" href="http://kombu.readthedocs.org/en/latest/reference/kombu.common.html#kombu.common.maybe_declare" title="(in Kombu v2.2)"><tt class="xref py py-func docutils literal"><span class="pre">maybe_declare()</span></tt></a> to cache queue declarations.</p>
</li>
<li><p class="first">There is no longer a global default for the
<a class="reference internal" href="configuration.html#std:setting-CELERYBEAT_MAX_LOOP_INTERVAL"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYBEAT_MAX_LOOP_INTERVAL</span></tt></a> setting, it is instead
set by individual schedulers.</p>
</li>
<li><p class="first">Worker: now truncates very long message bodies in error reports.</p>
</li>
<li><p class="first">No longer deepcopies exceptions when trying to serialize errors.</p>
</li>
<li><p class="first"><span class="target" id="index-1"></span><tt class="xref std std-envvar docutils literal"><span class="pre">CELERY_BENCH</span></tt> environment variable, will now also list
memory usage statistics at worker shutdown.</p>
</li>
<li><p class="first">Worker: now only ever use a single timer for all timing needs,
and instead set different priorities.</p>
</li>
<li><p class="first">An exceptions arguments are now safely pickled</p>
<blockquote>
<div><p>Contributed by Matt Long.</p>
</div></blockquote>
</li>
<li><p class="first">Worker/Celerybeat no longer logs the startup banner.</p>
<blockquote>
<div><p>Previously it would be logged with severity warning,
no it&#8217;s only written to stdout.</p>
</div></blockquote>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">contrib/</span></tt> directory in the distribution has been renamed to
<tt class="docutils literal"><span class="pre">extra/</span></tt>.</p>
</li>
<li><p class="first">New signal: <a class="reference internal" href="userguide/signals.html#std:signal-task_revoked"><tt class="xref std std-signal docutils literal"><span class="pre">task_revoked</span></tt></a></p>
</li>
<li><p class="first">celery.contrib.migrate: Many improvements including
filtering, queue migration, and support for acking messages on the broker
migrating from.</p>
<blockquote>
<div><p>Contributed by John Watson.</p>
</div></blockquote>
</li>
<li><p class="first">Worker: Prefetch count increments are now optimized and grouped together.</p>
</li>
<li><p class="first">Worker: No longer calls <tt class="docutils literal"><span class="pre">consume</span></tt> on the remote control command queue
twice.</p>
<blockquote>
<div><p>Probably didn&#8217;t cause any problems, but was unecessary.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="internals">
<h3>Internals<a class="headerlink" href="#internals" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">app.broker_connection</span></tt> is now <tt class="docutils literal"><span class="pre">app.connection</span></tt></p>
<blockquote>
<div><p>Both names still work.</p>
</div></blockquote>
</li>
<li><p class="first">Compat modules are now generated dynamically upon use.</p>
<blockquote>
<div><p>These modules are <tt class="docutils literal"><span class="pre">celery.messaging</span></tt>, <tt class="docutils literal"><span class="pre">celery.log</span></tt>,
<tt class="docutils literal"><span class="pre">celery.decorators</span></tt> and <tt class="docutils literal"><span class="pre">celery.registry</span></tt>.</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="internals/reference/celery.utils.html#module-celery.utils" title="celery.utils"><tt class="xref py py-mod docutils literal"><span class="pre">celery.utils</span></tt></a> refactored into multiple modules:</p>
<blockquote>
<div><p><a class="reference internal" href="internals/reference/celery.utils.text.html#module-celery.utils.text" title="celery.utils.text"><tt class="xref py py-mod docutils literal"><span class="pre">celery.utils.text</span></tt></a>
<a class="reference internal" href="internals/reference/celery.utils.imports.html#module-celery.utils.imports" title="celery.utils.imports"><tt class="xref py py-mod docutils literal"><span class="pre">celery.utils.imports</span></tt></a>
<a class="reference internal" href="internals/reference/celery.utils.functional.html#module-celery.utils.functional" title="celery.utils.functional"><tt class="xref py py-mod docutils literal"><span class="pre">celery.utils.functional</span></tt></a></p>
</div></blockquote>
</li>
<li><p class="first">Now using <a class="reference external" href="http://kombu.readthedocs.org/en/latest/reference/kombu.utils.encoding.html#kombu.utils.encoding" title="(in Kombu v2.2)"><tt class="xref py py-mod docutils literal"><span class="pre">kombu.utils.encoding</span></tt></a> instead of
<cite>:mod:`celery.utils.encoding</cite>.</p>
</li>
<li><p class="first">Renamed module <tt class="docutils literal"><span class="pre">celery.routes</span></tt> -&gt; <a class="reference internal" href="internals/reference/celery.app.routes.html#module-celery.app.routes" title="celery.app.routes"><tt class="xref py py-mod docutils literal"><span class="pre">celery.app.routes</span></tt></a>.</p>
</li>
<li><p class="first">Renamed package <tt class="docutils literal"><span class="pre">celery.db</span></tt> -&gt; <a class="reference internal" href="internals/reference/celery.backends.database.html#module-celery.backends.database" title="celery.backends.database"><tt class="xref py py-mod docutils literal"><span class="pre">celery.backends.database</span></tt></a>.</p>
</li>
<li><p class="first">Renamed module <tt class="docutils literal"><span class="pre">celery.abstract</span></tt> -&gt; <a class="reference internal" href="internals/reference/celery.worker.bootsteps.html#module-celery.worker.bootsteps" title="celery.worker.bootsteps"><tt class="xref py py-mod docutils literal"><span class="pre">celery.worker.bootsteps</span></tt></a>.</p>
</li>
<li><p class="first">Command-line docs are now parsed from the module docstrings.</p>
</li>
<li><p class="first">Test suite directory has been reorganized.</p>
</li>
<li><p class="first"><strong class="program">setup.py</strong> now reads docs from the <tt class="file docutils literal"><span class="pre">requirements/</span></tt> directory.</p>
</li>
<li><p class="first">Celery commands no longer wraps output (Issue <span class="xref issue">#700</span>).</p>
<blockquote>
<div><p>Contributed by Thomas Johansson.</p>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="experimental">
<span id="v300-experimental"></span><h2>Experimental<a class="headerlink" href="#experimental" title="Permalink to this headline">¶</a></h2>
<div class="section" id="celery-contrib-methods-task-decorator-for-methods">
<h3><a class="reference internal" href="reference/celery.contrib.methods.html#module-celery.contrib.methods" title="celery.contrib.methods"><tt class="xref py py-mod docutils literal"><span class="pre">celery.contrib.methods</span></tt></a>:  Task decorator for methods<a class="headerlink" href="#celery-contrib-methods-task-decorator-for-methods" title="Permalink to this headline">¶</a></h3>
<p>This is an experimental module containing a task
decorator, and a task decorator filter, that can be used
to create tasks out of methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">celery.contrib.methods</span> <span class="kn">import</span> <span class="n">task_method</span>

<span class="k">class</span> <span class="nc">Counter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="nd">@celery.task</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Counter.increment&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="n">task_method</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="reference/celery.contrib.methods.html#module-celery.contrib.methods" title="celery.contrib.methods"><tt class="xref py py-mod docutils literal"><span class="pre">celery.contrib.methods</span></tt></a> for more information.</p>
</div>
</div>
<div class="section" id="unscheduled-removals">
<span id="v300-unscheduled-removals"></span><h2>Unscheduled Removals<a class="headerlink" href="#unscheduled-removals" title="Permalink to this headline">¶</a></h2>
<p>Usually we don&#8217;t make backward incompatible removals,
but these removals should have no major effect.</p>
<ul>
<li><p class="first">The following settings have been renamed:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">CELERYD_ETA_SCHEDULER</span></tt> -&gt; <tt class="docutils literal"><span class="pre">CELERYD_TIMER</span></tt></li>
<li><tt class="docutils literal"><span class="pre">CELERYD_ETA_SCHEDULER_PRECISION</span></tt> -&gt; <tt class="docutils literal"><span class="pre">CELERYD_TIMER_PRECISION</span></tt></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="deprecations">
<span id="v300-deprecations"></span><h2>Deprecations<a class="headerlink" href="#deprecations" title="Permalink to this headline">¶</a></h2>
<p>See the <a class="reference internal" href="internals/deprecation.html#deprecation-timeline"><em>Celery Deprecation Timeline</em></a>.</p>
<ul>
<li><p class="first">The <tt class="docutils literal"><span class="pre">celery.backends.pyredis</span></tt> compat module has been removed.</p>
<blockquote>
<div><p>Use <a class="reference internal" href="internals/reference/celery.backends.redis.html#module-celery.backends.redis" title="celery.backends.redis"><tt class="xref py py-mod docutils literal"><span class="pre">celery.backends.redis</span></tt></a> instead!</p>
</div></blockquote>
</li>
<li><p class="first">The following undocumented API&#8217;s has been moved:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">control.inspect.add_consumer</span></tt> -&gt; <a class="reference internal" href="reference/celery.app.control.html#celery.app.control.Control.add_consumer" title="celery.app.control.Control.add_consumer"><tt class="xref py py-meth docutils literal"><span class="pre">celery.control.add_consumer()</span></tt></a>.</li>
<li><tt class="docutils literal"><span class="pre">control.inspect.cancel_consumer</span></tt> -&gt; <a class="reference internal" href="reference/celery.app.control.html#celery.app.control.Control.cancel_consumer" title="celery.app.control.Control.cancel_consumer"><tt class="xref py py-meth docutils literal"><span class="pre">celery.control.cancel_consumer()</span></tt></a>.</li>
<li><tt class="docutils literal"><span class="pre">control.inspect.enable_events</span></tt> -&gt; <a class="reference internal" href="reference/celery.app.control.html#celery.app.control.Control.enable_events" title="celery.app.control.Control.enable_events"><tt class="xref py py-meth docutils literal"><span class="pre">celery.control.enable_events()</span></tt></a>.</li>
<li><tt class="docutils literal"><span class="pre">control.inspect.disable_events</span></tt> -&gt; <a class="reference internal" href="reference/celery.app.control.html#celery.app.control.Control.disable_events" title="celery.app.control.Control.disable_events"><tt class="xref py py-meth docutils literal"><span class="pre">celery.control.disable_events()</span></tt></a>.</li>
</ul>
<p>This way <tt class="docutils literal"><span class="pre">inspect()</span></tt> is only used for commands that do not
modify anything, while idempotent control commands that make changes
are on the control objects.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="fixes">
<h2>Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Retry sqlalchemy backend operations on DatabaseError/OperationalError
(Issue <span class="xref issue">#634</span>)</p>
</li>
<li><p class="first">Tasks that called <tt class="docutils literal"><span class="pre">retry</span></tt> was not acknowledged if acks late was enabled</p>
<blockquote>
<div><p>Fix contributed by David Markey.</p>
</div></blockquote>
</li>
<li><p class="first">The message priority argument was not properly propagated to Kombu
(Issue <span class="xref issue">#708</span>).</p>
<blockquote>
<div><p>Fix contributed by Eran Rundstein</p>
</div></blockquote>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="index.html">
  <img class="logo" src="http://cloud.github.com/downloads/celery/celery/celery_128.png" alt="Logo"/>
</a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="faq.html"
                        title="previous chapter">Frequently Asked Questions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="whatsnew-2.5.html"
                        title="next chapter">What&#8217;s new in Celery 2.5</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/whatsnew-3.0.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="whatsnew-2.5.html" title="What’s new in Celery 2.5"
             >next</a> |</li>
        <li class="right" >
          <a href="faq.html" title="Frequently Asked Questions"
             >previous</a> |</li>
        <li><a href="index.html">Celery 3.1.0a1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="copyright.html">Copyright</a> 2009-2012, Ask Solem &amp; Contributors.
    </div>
  </body>
</html>