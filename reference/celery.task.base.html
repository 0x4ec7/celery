<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>celery.task.base &mdash; Celery 2.6.0a3 documentation</title>
    
    <link rel="stylesheet" href="../_static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/issuetracker.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.6.0a3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Celery 2.6.0a3 documentation" href="../index.html" />
    <link rel="up" title="API Reference" href="index.html" />
    <link rel="next" title="celery.task.sets" href="celery.task.sets.html" />
    <link rel="prev" title="celery.task" href="celery.task.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="celery.task.sets.html" title="celery.task.sets"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="celery.task.html" title="celery.task"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Celery 2.6.0a3 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">API Reference</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
<div class="deck">

    
        <p class="developmentversion">
        This document is for Celery's development version, which can be
        significantly different from previous releases. Get old docs here:

        <a href="http://docs.celeryproject.org/en/latest/reference/celery.task.base.html">2.5</a>.
        </p>
        

</div>
    <div class="section" id="celery-task-base">
<h1>celery.task.base<a class="headerlink" href="#celery-task-base" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id2">celery.task.base</a></li>
</ul>
</div>
<span class="target" id="module-celery.task.base"></span><div class="section" id="id1">
<h2><a class="toc-backref" href="#id2">celery.task.base</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>The task implementation has been moved to <a class="reference internal" href="celery.app.task.html#module-celery.app.task" title="celery.app.task"><tt class="xref py py-mod docutils literal"><span class="pre">celery.app.task</span></tt></a>.</p>
<p>This contains the backward compatible Task class used in the old API.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">copyright:</th><td class="field-body"><ol class="first loweralpha simple" start="3">
<li>2009 - 2012 by Ask Solem.</li>
</ol>
</td>
</tr>
<tr class="field-even field"><th class="field-name">license:</th><td class="field-body"><p class="first last">BSD, see LICENSE for more details.</p>
</td>
</tr>
</tbody>
</table>
<dl class="class">
<dt id="celery.task.base.BaseTask">
<em class="property">class </em><tt class="descclassname">celery.task.base.</tt><tt class="descname">BaseTask</tt><a class="headerlink" href="#celery.task.base.BaseTask" title="Permalink to this definition">¶</a></dt>
<dd><p>Task base class.</p>
<p>When called tasks apply the <a class="reference internal" href="#celery.task.base.BaseTask.run" title="celery.task.base.BaseTask.run"><tt class="xref py py-meth docutils literal"><span class="pre">run()</span></tt></a> method.  This method must
be defined by all tasks (that is unless the <tt class="xref py py-meth docutils literal"><span class="pre">__call__()</span></tt> method
is overridden).</p>
<dl class="method">
<dt id="celery.task.base.BaseTask.AsyncResult">
<tt class="descname">AsyncResult</tt><big>(</big><em>task_id</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.AsyncResult" title="Permalink to this definition">¶</a></dt>
<dd><p>Get AsyncResult instance for this kind of task.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>task_id</strong> &#8211; Task id to get result for.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="celery.task.base.BaseTask.ErrorMail">
<em class="property">class </em><tt class="descname">ErrorMail</tt><big>(</big><em>task</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.ErrorMail" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines how and when task error e-mails should be sent.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>task</strong> &#8211; The task instance that raised the error.</td>
</tr>
</tbody>
</table>
<p><tt class="xref py py-attr docutils literal"><span class="pre">subject</span></tt> and <tt class="xref py py-attr docutils literal"><span class="pre">body</span></tt> are format strings which
are passed a context containing the following keys:</p>
<ul>
<li><p class="first">name</p>
<blockquote>
<div><p>Name of the task.</p>
</div></blockquote>
</li>
<li><p class="first">id</p>
<blockquote>
<div><p>UUID of the task.</p>
</div></blockquote>
</li>
<li><p class="first">exc</p>
<blockquote>
<div><p>String representation of the exception.</p>
</div></blockquote>
</li>
<li><p class="first">args</p>
<blockquote>
<div><p>Positional arguments.</p>
</div></blockquote>
</li>
<li><p class="first">kwargs</p>
<blockquote>
<div><p>Keyword arguments.</p>
</div></blockquote>
</li>
<li><p class="first">traceback</p>
<blockquote>
<div><p>String representation of the traceback.</p>
</div></blockquote>
</li>
<li><p class="first">hostname</p>
<blockquote>
<div><p>Worker hostname.</p>
</div></blockquote>
</li>
</ul>
<dl class="method">
<dt id="celery.task.base.BaseTask.ErrorMail.should_send">
<tt class="descname">should_send</tt><big>(</big><em>context</em>, <em>exc</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.ErrorMail.should_send" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true or false depending on if a task error mail
should be sent for this type of error.</p>
</dd></dl>

</dd></dl>

<dl class="exception">
<dt id="celery.task.base.BaseTask.MaxRetriesExceededError">
<em class="property">exception </em><tt class="descclassname">BaseTask.</tt><tt class="descname">MaxRetriesExceededError</tt><a class="headerlink" href="#celery.task.base.BaseTask.MaxRetriesExceededError" title="Permalink to this definition">¶</a></dt>
<dd><p>The tasks max restart limit has been exceeded.</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.after_return">
<tt class="descclassname">BaseTask.</tt><tt class="descname">after_return</tt><big>(</big><em>status</em>, <em>retval</em>, <em>task_id</em>, <em>args</em>, <em>kwargs</em>, <em>einfo</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.after_return" title="Permalink to this definition">¶</a></dt>
<dd><p>Handler called after the task returns.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>status</strong> &#8211; Current task state.</li>
<li><strong>retval</strong> &#8211; Task return value/exception.</li>
<li><strong>task_id</strong> &#8211; Unique id of the task.</li>
<li><strong>args</strong> &#8211; Original arguments for the task that failed.</li>
<li><strong>kwargs</strong> &#8211; Original keyword arguments for the task
that failed.</li>
<li><strong>einfo</strong> &#8211; <a class="reference internal" href="../internals/reference/celery.datastructures.html#celery.datastructures.ExceptionInfo" title="celery.datastructures.ExceptionInfo"><tt class="xref py py-class docutils literal"><span class="pre">ExceptionInfo</span></tt></a>
instance, containing the traceback (if any).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The return value of this handler is ignored.</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.apply">
<tt class="descclassname">BaseTask.</tt><tt class="descname">apply</tt><big>(</big><em>args=None</em>, <em>kwargs=None</em>, <em>**options</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.apply" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute this task locally, by blocking until the task returns.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>args</strong> &#8211; positional arguments passed on to the task.</li>
<li><strong>kwargs</strong> &#8211; keyword arguments passed on to the task.</li>
<li><strong>throw</strong> &#8211; Re-raise task exceptions.  Defaults to
the <a class="reference internal" href="../configuration.html#std:setting-CELERY_EAGER_PROPAGATES_EXCEPTIONS"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_EAGER_PROPAGATES_EXCEPTIONS</span></tt></a>
setting.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>:rtype <a class="reference internal" href="celery.result.html#celery.result.EagerResult" title="celery.result.EagerResult"><tt class="xref py py-class docutils literal"><span class="pre">celery.result.EagerResult</span></tt></a>:</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.apply_async">
<tt class="descclassname">BaseTask.</tt><tt class="descname">apply_async</tt><big>(</big><em>args=None</em>, <em>kwargs=None</em>, <em>task_id=None</em>, <em>publisher=None</em>, <em>connection=None</em>, <em>router=None</em>, <em>queues=None</em>, <em>link=None</em>, <em>link_error=None</em>, <em>**options</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.apply_async" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply tasks asynchronously by sending a message.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>args</strong> &#8211; The positional arguments to pass on to the
task (a <tt class="xref py py-class docutils literal"><span class="pre">list</span></tt> or <tt class="xref py py-class docutils literal"><span class="pre">tuple</span></tt>).</li>
<li><strong>kwargs</strong> &#8211; The keyword arguments to pass on to the
task (a <a class="reference external" href="http://docs.python.org/dev/library/stdtypes.html#dict" title="(in Python v3.3)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a>)</li>
<li><strong>countdown</strong> &#8211; Number of seconds into the future that the
task should execute. Defaults to immediate
execution (do not confuse with the
<cite>immediate</cite> flag, as they are unrelated).</li>
<li><strong>eta</strong> &#8211; A <a class="reference external" href="http://docs.python.org/dev/library/datetime.html#datetime.datetime" title="(in Python v3.3)"><tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt></a> object describing
the absolute time and date of when the task should
be executed.  May not be specified if <cite>countdown</cite>
is also supplied.  (Do not confuse this with the
<cite>immediate</cite> flag, as they are unrelated).</li>
<li><strong>expires</strong> &#8211; Either a <tt class="xref py py-class docutils literal"><span class="pre">int</span></tt>, describing the number of
seconds, or a <a class="reference external" href="http://docs.python.org/dev/library/datetime.html#datetime.datetime" title="(in Python v3.3)"><tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt></a> object
that describes the absolute time and date of when
the task should expire.  The task will not be
executed after the expiration time.</li>
<li><strong>connection</strong> &#8211; Re-use existing broker connection instead
of establishing a new one.</li>
<li><strong>retry</strong> &#8211; If enabled sending of the task message will be retried
in the event of connection loss or failure.  Default
is taken from the <a class="reference internal" href="../configuration.html#std:setting-CELERY_TASK_PUBLISH_RETRY"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_PUBLISH_RETRY</span></tt></a>
setting.  Note you need to handle the
publisher/connection manually for this to work.</li>
<li><strong>retry_policy</strong> &#8211; Override the retry policy used.  See the
<a class="reference internal" href="../configuration.html#std:setting-CELERY_TASK_PUBLISH_RETRY"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_TASK_PUBLISH_RETRY</span></tt></a> setting.</li>
<li><strong>routing_key</strong> &#8211; The routing key used to route the task to a
worker server.  Defaults to the
<tt class="xref py py-attr docutils literal"><span class="pre">routing_key</span></tt> attribute.</li>
<li><strong>exchange</strong> &#8211; The named exchange to send the task to.
Defaults to the <tt class="xref py py-attr docutils literal"><span class="pre">exchange</span></tt> attribute.</li>
<li><strong>exchange_type</strong> &#8211; The exchange type to initialize the exchange
if not already declared.  Defaults to the
<tt class="xref py py-attr docutils literal"><span class="pre">exchange_type</span></tt> attribute.</li>
<li><strong>immediate</strong> &#8211; Request immediate delivery.  Will raise an
exception if the task cannot be routed to a worker
immediately.  (Do not confuse this parameter with
the <cite>countdown</cite> and <cite>eta</cite> settings, as they are
unrelated).  Defaults to the <tt class="xref py py-attr docutils literal"><span class="pre">immediate</span></tt>
attribute.</li>
<li><strong>mandatory</strong> &#8211; Mandatory routing. Raises an exception if
there&#8217;s no running workers able to take on this
task.  Defaults to the <tt class="xref py py-attr docutils literal"><span class="pre">mandatory</span></tt>
attribute.</li>
<li><strong>priority</strong> &#8211; The task priority, a number between 0 and 9.
Defaults to the <tt class="xref py py-attr docutils literal"><span class="pre">priority</span></tt> attribute.</li>
<li><strong>serializer</strong> &#8211; A string identifying the default
serialization method to use.  Can be <cite>pickle</cite>,
<cite>json</cite>, <cite>yaml</cite>, <cite>msgpack</cite> or any custom
serialization method that has been registered
with <tt class="xref py py-mod docutils literal"><span class="pre">kombu.serialization.registry</span></tt>.
Defaults to the <tt class="xref py py-attr docutils literal"><span class="pre">serializer</span></tt> attribute.</li>
<li><strong>compression</strong> &#8211; A string identifying the compression method
to use.  Can be one of <tt class="docutils literal"><span class="pre">zlib</span></tt>, <tt class="docutils literal"><span class="pre">bzip2</span></tt>,
or any custom compression methods registered with
<a class="reference external" href="http://kombu.readthedocs.org/en/latest/reference/kombu.compression.html#kombu.compression.register" title="(in Kombu v2.1)"><tt class="xref py py-func docutils literal"><span class="pre">kombu.compression.register()</span></tt></a>. Defaults to
the <a class="reference internal" href="../configuration.html#std:setting-CELERY_MESSAGE_COMPRESSION"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_MESSAGE_COMPRESSION</span></tt></a>
setting.</li>
<li><strong>link</strong> &#8211; A single, or a list of subtasks to apply if the
task exits successfully.</li>
<li><strong>link_error</strong> &#8211; A single, or a list of subtasks to apply
if an error occurs while executing the task.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the <a class="reference internal" href="../configuration.html#std:setting-CELERY_ALWAYS_EAGER"><tt class="xref std std-setting docutils literal"><span class="pre">CELERY_ALWAYS_EAGER</span></tt></a> setting is set, it will
be replaced by a local <a class="reference internal" href="#celery.task.base.BaseTask.apply" title="celery.task.base.BaseTask.apply"><tt class="xref py py-func docutils literal"><span class="pre">apply()</span></tt></a> call instead.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.delay">
<tt class="descclassname">BaseTask.</tt><tt class="descname">delay</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.delay" title="Permalink to this definition">¶</a></dt>
<dd><p>Star argument version of <a class="reference internal" href="#celery.task.base.BaseTask.apply_async" title="celery.task.base.BaseTask.apply_async"><tt class="xref py py-meth docutils literal"><span class="pre">apply_async()</span></tt></a>.</p>
<p>Does not support the extra options enabled by <a class="reference internal" href="#celery.task.base.BaseTask.apply_async" title="celery.task.base.BaseTask.apply_async"><tt class="xref py py-meth docutils literal"><span class="pre">apply_async()</span></tt></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>*args</strong> &#8211; positional arguments passed on to the task.</li>
<li><strong>**kwargs</strong> &#8211; keyword arguments passed on to the task.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>:returns <a class="reference internal" href="celery.result.html#celery.result.AsyncResult" title="celery.result.AsyncResult"><tt class="xref py py-class docutils literal"><span class="pre">celery.result.AsyncResult</span></tt></a>:</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.establish_connection">
<tt class="descclassname">BaseTask.</tt><tt class="descname">establish_connection</tt><big>(</big><em>connect_timeout=None</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.establish_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Establish a connection to the message broker.</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.execute">
<tt class="descclassname">BaseTask.</tt><tt class="descname">execute</tt><big>(</big><em>request</em>, <em>pool</em>, <em>loglevel</em>, <em>logfile</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.execute" title="Permalink to this definition">¶</a></dt>
<dd><p>The method the worker calls to execute the task.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>request</strong> &#8211; A <a class="reference internal" href="../internals/reference/celery.worker.job.html#celery.worker.job.Request" title="celery.worker.job.Request"><tt class="xref py py-class docutils literal"><span class="pre">Request</span></tt></a>.</li>
<li><strong>pool</strong> &#8211; A task pool.</li>
<li><strong>loglevel</strong> &#8211; Current loglevel.</li>
<li><strong>logfile</strong> &#8211; Name of the currently used logfile.</li>
<li><strong>consumer</strong> &#8211; The <a class="reference internal" href="../internals/reference/celery.worker.consumer.html#celery.worker.consumer.Consumer" title="celery.worker.consumer.Consumer"><tt class="xref py py-class docutils literal"><span class="pre">Consumer</span></tt></a>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.get_consumer">
<tt class="descclassname">BaseTask.</tt><tt class="descname">get_consumer</tt><big>(</big><em>connection=None</em>, <em>connect_timeout=None</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.get_consumer" title="Permalink to this definition">¶</a></dt>
<dd><p>Get message consumer.</p>
<p>:rtype <a class="reference external" href="http://kombu.readthedocs.org/en/latest/reference/kombu.messaging.html#kombu.messaging.Consumer" title="(in Kombu v2.1)"><tt class="xref py py-class docutils literal"><span class="pre">kombu.messaging.Consumer</span></tt></a>:</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>If you don&#8217;t specify a connection, one will automatically
be established for you, in that case you need to close this
connection after use:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">consumer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_consumer</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># do something with consumer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">consumer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">consumer</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.get_logger">
<tt class="descclassname">BaseTask.</tt><tt class="descname">get_logger</tt><big>(</big><em>**kwargs</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.get_logger" title="Permalink to this definition">¶</a></dt>
<dd><p>Get task-aware logger object.</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.get_publisher">
<tt class="descclassname">BaseTask.</tt><tt class="descname">get_publisher</tt><big>(</big><em>connection=None</em>, <em>exchange=None</em>, <em>connect_timeout=None</em>, <em>exchange_type=None</em>, <em>**options</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.get_publisher" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a celery task message publisher.</p>
<p>:rtype <a class="reference internal" href="celery.app.amqp.html#celery.app.amqp.TaskPublisher" title="celery.app.amqp.TaskPublisher"><tt class="xref py py-class docutils literal"><span class="pre">TaskPublisher</span></tt></a>:</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>If you don&#8217;t specify a connection, one will automatically
be established for you, in that case you need to close this
connection after use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">publisher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publisher</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># ... do something with publisher</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">publisher</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>or used as a context:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_publisher</span><span class="p">()</span> <span class="k">as</span> <span class="n">publisher</span><span class="p">:</span>
<span class="gp">... </span>    <span class="c"># ... do something with publisher</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.on_bound">
<tt class="descclassname">BaseTask.</tt><tt class="descname">on_bound</tt><big>(</big><em>app</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.on_bound" title="Permalink to this definition">¶</a></dt>
<dd><p>This method can be defined to do additional actions when the
task class is bound to an app.</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.on_failure">
<tt class="descclassname">BaseTask.</tt><tt class="descname">on_failure</tt><big>(</big><em>exc</em>, <em>task_id</em>, <em>args</em>, <em>kwargs</em>, <em>einfo</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.on_failure" title="Permalink to this definition">¶</a></dt>
<dd><p>Error handler.</p>
<p>This is run by the worker when the task fails.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>exc</strong> &#8211; The exception raised by the task.</li>
<li><strong>task_id</strong> &#8211; Unique id of the failed task.</li>
<li><strong>args</strong> &#8211; Original arguments for the task that failed.</li>
<li><strong>kwargs</strong> &#8211; Original keyword arguments for the task
that failed.</li>
<li><strong>einfo</strong> &#8211; <a class="reference internal" href="../internals/reference/celery.datastructures.html#celery.datastructures.ExceptionInfo" title="celery.datastructures.ExceptionInfo"><tt class="xref py py-class docutils literal"><span class="pre">ExceptionInfo</span></tt></a>
instance, containing the traceback.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The return value of this handler is ignored.</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.on_retry">
<tt class="descclassname">BaseTask.</tt><tt class="descname">on_retry</tt><big>(</big><em>exc</em>, <em>task_id</em>, <em>args</em>, <em>kwargs</em>, <em>einfo</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.on_retry" title="Permalink to this definition">¶</a></dt>
<dd><p>Retry handler.</p>
<p>This is run by the worker when the task is to be retried.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>exc</strong> &#8211; The exception sent to <a class="reference internal" href="#celery.task.base.BaseTask.retry" title="celery.task.base.BaseTask.retry"><tt class="xref py py-meth docutils literal"><span class="pre">retry()</span></tt></a>.</li>
<li><strong>task_id</strong> &#8211; Unique id of the retried task.</li>
<li><strong>args</strong> &#8211; Original arguments for the retried task.</li>
<li><strong>kwargs</strong> &#8211; Original keyword arguments for the retried task.</li>
<li><strong>einfo</strong> &#8211; <a class="reference internal" href="../internals/reference/celery.datastructures.html#celery.datastructures.ExceptionInfo" title="celery.datastructures.ExceptionInfo"><tt class="xref py py-class docutils literal"><span class="pre">ExceptionInfo</span></tt></a>
instance, containing the traceback.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The return value of this handler is ignored.</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.on_success">
<tt class="descclassname">BaseTask.</tt><tt class="descname">on_success</tt><big>(</big><em>retval</em>, <em>task_id</em>, <em>args</em>, <em>kwargs</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.on_success" title="Permalink to this definition">¶</a></dt>
<dd><p>Success handler.</p>
<p>Run by the worker if the task executes successfully.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>retval</strong> &#8211; The return value of the task.</li>
<li><strong>task_id</strong> &#8211; Unique id of the executed task.</li>
<li><strong>args</strong> &#8211; Original arguments for the executed task.</li>
<li><strong>kwargs</strong> &#8211; Original keyword arguments for the executed task.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The return value of this handler is ignored.</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.retry">
<tt class="descclassname">BaseTask.</tt><tt class="descname">retry</tt><big>(</big><em>args=None</em>, <em>kwargs=None</em>, <em>exc=None</em>, <em>throw=True</em>, <em>eta=None</em>, <em>countdown=None</em>, <em>max_retries=None</em>, <em>**options</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.retry" title="Permalink to this definition">¶</a></dt>
<dd><p>Retry the task.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>args</strong> &#8211; Positional arguments to retry with.</li>
<li><strong>kwargs</strong> &#8211; Keyword arguments to retry with.</li>
<li><strong>exc</strong> &#8211; Optional exception to raise instead of
<a class="reference internal" href="celery.exceptions.html#celery.exceptions.MaxRetriesExceededError" title="celery.exceptions.MaxRetriesExceededError"><tt class="xref py py-exc docutils literal"><span class="pre">MaxRetriesExceededError</span></tt></a>
when the max restart limit has been exceeded.</li>
<li><strong>countdown</strong> &#8211; Time in seconds to delay the retry for.</li>
<li><strong>eta</strong> &#8211; Explicit time and date to run the retry at
(must be a <a class="reference external" href="http://docs.python.org/dev/library/datetime.html#datetime.datetime" title="(in Python v3.3)"><tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt></a> instance).</li>
<li><strong>max_retries</strong> &#8211; If set, overrides the default retry limit.</li>
<li><strong>**options</strong> &#8211; Any extra options to pass on to
meth:<cite>apply_async</cite>.</li>
<li><strong>throw</strong> &#8211; If this is <tt class="xref py py-const docutils literal"><span class="pre">False</span></tt>, do not raise the
<a class="reference internal" href="celery.exceptions.html#celery.exceptions.RetryTaskError" title="celery.exceptions.RetryTaskError"><tt class="xref py py-exc docutils literal"><span class="pre">RetryTaskError</span></tt></a> exception,
that tells the worker to mark the task as being
retried.  Note that this means the task will be
marked as failed if the task raises an exception,
or successful if it returns.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Raises <a class="reference internal" href="celery.exceptions.html#celery.exceptions.RetryTaskError" title="celery.exceptions.RetryTaskError">celery.exceptions.RetryTaskError</a>:</th></tr>
<tr class="field-even field"><td>&nbsp;</td><td class="field-body"><p class="first last">To tell the worker that
the task has been re-sent for retry. This always happens,
unless the <cite>throw</cite> keyword argument has been explicitly set
to <tt class="xref py py-const docutils literal"><span class="pre">False</span></tt>, and is considered normal operation.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nd">@task</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">tweet</span><span class="p">(</span><span class="n">auth</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">twitter</span> <span class="o">=</span> <span class="n">Twitter</span><span class="p">(</span><span class="n">oauth</span><span class="o">=</span><span class="n">auth</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">twitter</span><span class="o">.</span><span class="n">post_status_update</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">except</span> <span class="n">twitter</span><span class="o">.</span><span class="n">FailWhale</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span>
<span class="gp">... </span>        <span class="c"># Retry in 5 minutes.</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">tweet</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span><span class="n">countdown</span><span class="o">=</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="n">exc</span><span class="o">=</span><span class="n">exc</span><span class="p">)</span>
</pre></div>
</div>
<p>Although the task will never return above as <cite>retry</cite> raises an
exception to notify the worker, we use <cite>return</cite> in front of the retry
to convey that the rest of the block will not be executed.</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.run">
<tt class="descclassname">BaseTask.</tt><tt class="descname">run</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.run" title="Permalink to this definition">¶</a></dt>
<dd><p>The body of the task executed by workers.</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.s">
<tt class="descclassname">BaseTask.</tt><tt class="descname">s</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.s" title="Permalink to this definition">¶</a></dt>
<dd><p><tt class="docutils literal"><span class="pre">.s(*a,</span> <span class="pre">**k)</span> <span class="pre">-&gt;</span> <span class="pre">.subtask(a,</span> <span class="pre">k)</span></tt></p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.subtask">
<tt class="descclassname">BaseTask.</tt><tt class="descname">subtask</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.subtask" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <tt class="xref py py-class docutils literal"><span class="pre">subtask</span></tt> object for
this task, wrapping arguments and execution options
for a single task invocation.</p>
</dd></dl>

<dl class="method">
<dt id="celery.task.base.BaseTask.update_state">
<tt class="descclassname">BaseTask.</tt><tt class="descname">update_state</tt><big>(</big><em>task_id=None</em>, <em>state=None</em>, <em>meta=None</em><big>)</big><a class="headerlink" href="#celery.task.base.BaseTask.update_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Update task state.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>task_id</strong> &#8211; Id of the task to update.</li>
<li><strong>state</strong> &#8211; New state (<tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>).</li>
<li><strong>meta</strong> &#8211; State metadata (<a class="reference external" href="http://docs.python.org/dev/library/stdtypes.html#dict" title="(in Python v3.3)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a>).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="celery.task.base.PeriodicTask">
<em class="property">class </em><tt class="descclassname">celery.task.base.</tt><tt class="descname">PeriodicTask</tt><a class="headerlink" href="#celery.task.base.PeriodicTask" title="Permalink to this definition">¶</a></dt>
<dd><p>A periodic task is a task that adds itself to the
<a class="reference internal" href="../configuration.html#std:setting-CELERYBEAT_SCHEDULE"><tt class="xref std std-setting docutils literal"><span class="pre">CELERYBEAT_SCHEDULE</span></tt></a> setting.</p>
</dd></dl>

<dl class="class">
<dt id="celery.task.base.TaskType">
<em class="property">class </em><tt class="descclassname">celery.task.base.</tt><tt class="descname">TaskType</tt><a class="headerlink" href="#celery.task.base.TaskType" title="Permalink to this definition">¶</a></dt>
<dd><p>Meta class for tasks.</p>
<p>Automatically registers the task in the task registry, except
if the <cite>abstract</cite> attribute is set.</p>
<p>If no <cite>name</cite> attribute is provided, then no name is automatically
set to the name of the module it was defined in, and the class name.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="../index.html">
  <img class="logo" src="http://cloud.github.com/downloads/ask/celery/celery_128.png" alt="Logo"/>
</a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="celery.task.html"
                        title="previous chapter">celery.task</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="celery.task.sets.html"
                        title="next chapter">celery.task.sets</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/reference/celery.task.base.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="celery.task.sets.html" title="celery.task.sets"
             >next</a> |</li>
        <li class="right" >
          <a href="celery.task.html" title="celery.task"
             >previous</a> |</li>
        <li><a href="../index.html">Celery 2.6.0a3 documentation</a> &raquo;</li>
          <li><a href="index.html" >API Reference</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2012, Ask Solem &amp; Contributors.
    </div>
  </body>
</html>